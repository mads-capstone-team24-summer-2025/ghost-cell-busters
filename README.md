# Dissecting Tumor and Normal Cell Identities in Breast Cancer at Single-Cell Resolution

This project analyzes single-cell and spatial transcriptomics data from human breast cancers, focusing on the identification and characterization of "ghost cells"—cells with abnormal transcriptomic or genomic features. The workflow includes data loading, feature engineering, ghost cell classification, CNV analysis, machine learning, and gene set enrichment.

---

## Folder Structure

```
ghost-cell-busters/
│
├── assets/
│   ├── GSE161529/
│   ├── GSE176078/
│   ├── GSE180286/
│   └── Gencode/
│
├── notebooks/
│   ├── 01. GSE176078.ipynb
│   ├── 02. GSE176078_model.ipynb
│   ├── 03. GSE161529_validation.ipynb
│   ├── 04. GSE161529_cross_validation.ipynb
│   ├── 05. GSE161529_oncogene.ipynb
│   ├── 06. GSE180286_validation.ipynb
│   ├── 07. GSE180286_cross_validation.ipynb
│   └── 08. GSE180286_oncogene.ipynb
│
├── scripts/
│   ├── Gencode_asset.py
│   ├── GSE161529_asset.py
│   ├── GSE176078_asset.py
│   └── GSE180286_asset.py
│
├── requirements.txt
├── README.md
└── .gitignore
```

---

## Setup Instructions

### 1. Clone the Repository

```sh
git clone <repo-url>
cd ghost-cell-busters
```

### 2. Install Dependencies

Recommended: Use a virtual environment.

```sh
python -m venv venv
venv\Scripts\activate  # On Windows
source venv/bin/activate  # On Mac/Linux

pip install -r requirements.txt
```

If `requirements.txt` is missing, install these packages:

```sh
pip install scanpy pandas numpy matplotlib seaborn scikit-learn gseapy mygene infercnvpy shap xgboost imbalanced-learn gtfparse
```

### 3. Data Preparation

- Use the scripts in the `scripts/` folder to help organize and prepare your data:
  - For each dataset, run the corresponding script to download or process files as needed. For example:
    ```sh
    python scripts/GSE176078_asset.py
    ```
    This will help set up the `assets/GSE176078/` directory with required files.
  - Similarly, use `GSE161529_asset.py` and `GSE180286_asset.py` for other datasets.
  - To prepare gene annotation assets, run:
    ```sh
    python scripts/Gencode_asset.py
    ```
    This will download the GTF annotation file (`gencode.v44.annotation.gtf.gz`) if not already present.

### 4. Running the Analysis

- Open `notebooks/GSE176078.ipynb` in Jupyter or VS Code.
- Execute cells sequentially to:
  - Load and preprocess data
  - Engineer features (cell cycle, apoptosis, ribosomal, OXPHOS, CNV scores)
  - Classify ghost cells
  - Visualize and analyze results
  - Run machine learning and interpret with SHAP
  - Perform pseudotime and gene set enrichment analyses

---

## Main Analysis Steps

1. **Data Loading:** Build AnnData object from raw files.
2. **Feature Engineering:** Compute cell cycle, apoptosis, ribosomal, OXPHOS, and CNV features.
3. **Ghost Cell Classification:** Define and refine ghost cell criteria.
4. **Visualization:** Plot distributions and proportions by subtype and cell type.
5. **Differential Expression:** Identify genes distinguishing ghost vs. non-ghost cells.
6. **CNV Analysis:** Annotate genes, run inferCNV, and score CNV burden.
7. **Machine Learning:** Train classifiers to predict ghost cells and tumor/normal status; interpret with SHAP.
8. **Pseudotime Analysis:** Compute and visualize pseudotime trajectories.
9. **Gene Set Enrichment:** Score MSigDB Hallmark gene sets.

---

## Outputs

- Processed AnnData objects (`*.pkl`)
- Feature tables (`*.csv`)
- Plots and figures (generated by running the notebooks)

---

## Notes

- The project uses both Python scripts and IPython notebooks.
- Some steps require substantial memory and compute (especially CNV and machine learning).

---

## References

- [Scanpy documentation](https://scanpy.readthedocs.io/)
- [infercnvpy documentation](https://icbi-lab.github.io/infercnvpy/)
- [MSigDB Hallmark gene sets](https://www.gsea-msigdb.org/gsea/msigdb/collections.jsp#H)
- [Gencode GTF files](https://www.gencodegenes.org/human/)

---

## Authors

- Haider Rizvi - [GitHub](https://github.com/hr080100)
- Rajeev Prasad - [GitHub](https://github.com/oliverraj)

---

**Note:** The `assets/` folder containing raw and processed data is **not included** in this repository due to size and LFS limitations.