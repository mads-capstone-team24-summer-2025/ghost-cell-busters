# Dissecting Tumor and Normal Cell Identities in Breast Cancer at Single-Cell Resolution

This project analyzes single-cell and spatial transcriptomics data from human breast cancers, focusing on the identification and characterization of "ghost cells"—cells with abnormal transcriptomic or genomic features. The workflow includes data loading, feature engineering, ghost cell classification, CNV analysis, machine learning, and gene set enrichment.

---

## Folder Structure

```
ghost-cell-busters/
│
├── assets/
│   ├── adata_obs_full.csv
│   ├── adata_obs_with_pseudotime.csv
│   ├── adata_sub.pkl
│   ├── adata.pkl
│   ├── gencode.v44.annotation.gtf.gz
│   ├── GSE161529_features.tsv.gz
│   ├── GSE161529_RAW/
│   └── GSE176078/
│
└── notebooks/
    ├── Ghost_Cell_Load_Explore.ipynb
    └── GSE176078.ipynb
```

---

## Setup Instructions

### 1. Clone the Repository

```sh
git clone <repo-url>
cd ghost-cell-busters
```

### 2. Install Dependencies

Recommended: Use a virtual environment.

```sh
python -m venv venv
venv\Scripts\activate  # On Windows
source venv/bin/activate  # On Mac/Linux

pip install -r requirements.txt
```

If `requirements.txt` is missing, install these packages:

```sh
pip install scanpy pandas numpy matplotlib seaborn scikit-learn gseapy mygene infercnvpy shap xgboost imbalanced-learn gtfparse
```

### 3. Data Preparation

- Place raw data files (e.g., `count_matrix_sparse.mtx`, `count_matrix_genes.tsv`, `count_matrix_barcodes.tsv`, `metadata.csv`) in the appropriate subfolders under `assets/`.
- Download the GTF annotation file (`gencode.v44.annotation.gtf.gz`) if not present. The notebook will attempt to download it automatically.

### 4. Running the Analysis

- Open `notebooks/GSE176078.ipynb` in Jupyter or VS Code.
- Execute cells sequentially to:
  - Load and preprocess data
  - Engineer features (cell cycle, apoptosis, ribosomal, OXPHOS, CNV scores)
  - Classify ghost cells
  - Visualize and analyze results
  - Run machine learning and interpret with SHAP
  - Perform pseudotime and gene set enrichment analyses

---

## Main Analysis Steps

1. **Data Loading:** Build AnnData object from raw files.
2. **Feature Engineering:** Compute cell cycle, apoptosis, ribosomal, OXPHOS, and CNV features.
3. **Ghost Cell Classification:** Define and refine ghost cell criteria.
4. **Visualization:** Plot distributions and proportions by subtype and cell type.
5. **Differential Expression:** Identify genes distinguishing ghost vs. non-ghost cells.
6. **CNV Analysis:** Annotate genes, run inferCNV, and score CNV burden.
7. **Machine Learning:** Train classifiers to predict ghost cells and tumor/normal status; interpret with SHAP.
8. **Pseudotime Analysis:** Compute and visualize pseudotime trajectories.
9. **Gene Set Enrichment:** Score MSigDB Hallmark gene sets.

---

## Outputs

- Processed AnnData objects (`adata.pkl`, `adata_sub.pkl`)
- Feature tables (`adata_obs_full.csv`, `adata_obs_with_pseudotime.csv`)
- Plots and figures (generated by running the notebooks)

---

## Notes

- The project uses both Python and Jupyter notebooks.
- Some steps require substantial memory and compute (especially CNV and machine learning).
- For reproducibility, set random seeds as shown in the notebooks.

---

## References

- [Scanpy documentation](https://scanpy.readthedocs.io/)
- [infercnvpy documentation](https://icbi-lab.github.io/infercnvpy/)
- [MSigDB Hallmark gene sets](https://www.gsea-msigdb.org/gsea/msigdb/collections.jsp#H)
- [Gencode GTF files](https://www.gencodegenes.org/human/)

---

## Authors

- Haider Rizvi - [GitHub](https://github.com/hr080100)
- Rajeev Prasad - [GitHub](https://github.com/oliverraj)

---

## Data Availability & Replication

**Note:** The `assets/` folder containing raw and processed data is **not included** in this repository due to size and LFS limitations.

### How to Replicate the Dataset

1. **Download Raw Data:**
   - Obtain the raw count matrices, gene/barcode tables, and metadata for GSE176078 from the [GEO database](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE176078) or the original publication's supplementary materials.
   - Required files typically include:
     - `count_matrix_sparse.mtx`
     - `count_matrix_genes.tsv`
     - `count_matrix_barcodes.tsv`
     - `metadata.csv`

2. **Directory Structure:**
   - Create the following folder structure in your project root:
     ```
     assets/
       └── GSE176078/
           ├── count_matrix_sparse.mtx
           ├── count_matrix_genes.tsv
           ├── count_matrix_barcodes.tsv
           └── metadata.csv
     ```
   - Place the downloaded files in the `assets/GSE176078/` directory.

3. **Gene Annotation File:**
   - The GTF annotation file (`gencode.v44.annotation.gtf.gz`) will be downloaded automatically by the notebook if not present.
   - Alternatively, you can manually download it from [GENCODE](https://www.gencodegenes.org/human/) and place it in the project root or `assets/`.